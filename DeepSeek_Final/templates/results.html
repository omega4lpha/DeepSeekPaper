<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados de Clasificaci√≥n</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    pre {
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 5px;
      font-size: 0.9rem;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="mb-4">Resultados de Clasificaci√≥n con LLM</h1>

    <h3 class="mt-4">‚è±Ô∏è Tiempos de ejecuci√≥n</h3>
    <ul class="list-group mb-4">
      {% for fase, tiempo in tiempos.items() %}
        <li class="list-group-item d-flex justify-content-between">
          <strong>{{ fase }}</strong>
          <span>{{ '%.2f' | format(tiempo) }} segundos</span>
        </li>
      {% endfor %}
    </ul>

    <h3 class="mt-4">üìä Resumen General</h3>
    <ul>
      <li><strong>Accuracy:</strong> {{ "%.2f"|format(accuracy) }}</li>
      <li><strong>Kappa de Cohen:</strong> {{ "%.2f"|format(kappa) }}</li>
      <li><strong>AUC:</strong>
        {% if auc == "No disponible" %}
          No disponible (requiere dos clases)
        {% else %}
          {{ "%.2f"|format(auc) }}
        {% endif %}
      </li>
    </ul>

    <h3 class="mt-4">üì® Prompt enviado</h3>
    <pre>{{ prompt }}</pre>

    <h3 class="mt-4">üß† Respuesta del modelo</h3>
    <pre>{{ response }}</pre>

    <h3 class="mt-4">üìà M√©tricas por clase</h3>
    <ul>
      {% for label, metrics in metrics.items() if label != 'accuracy' %}
        <li>
          <strong>{{ label }}</strong> ‚Äî
          Accuracy:{{ "%.2f"|format(accuracy) }},
          Precisi√≥n: {{ "%.2f"|format(metrics['precision']) }},
          Recall: {{ "%.2f"|format(metrics['recall']) }},
          F1: {{ "%.2f"|format(metrics['f1-score']) }}
        </li>
      {% endfor %}
    </ul>
    <p>üì° Ancho de banda:</p>
    <ul>
      <li>Enviados: {{ ancho_banda["Enviados (KB)"] }} KB</li>
      <li>Recibidos: {{ ancho_banda["Recibidos (KB)"] }} KB</li>
      <li>Total: {{ ancho_banda["Total (KB)"] }} KB</li>
    </ul>

    <h3 class="mt-4">üßÆ Matriz de Confusi√≥n</h3>

    {% set max_val = 0 %}
    {% for row in conf_matrix %}
      {% for val in row %}
        {% if val > max_val %}
          {% set max_val = val %}
        {% endif %}
      {% endfor %}
    {% endfor %}

    <table class="table table-bordered table-sm text-center align-middle">
      <thead class="table-light">
        <tr>
          <th></th>
          {% for label in labels %}
            <th>{{ label }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in conf_matrix %}
          {% set i = loop.index0 %}
          <tr>
            <th class="table-light">{{ labels[i] }}</th>
            {% for val in row %}
              {% if max_val > 0 %}
                {% set intensity = (val / max_val * 100) | round(0, 'floor') %}
              {% else %}
                {% set intensity = 0 %}
              {% endif %}
              <td style="background-color: rgba(0, 123, 255, {{ intensity / 100 }}); color: {% if intensity > 50 %}white{% else %}black{% endif %}">
                {{ val }}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <h3 class="mt-4">üîç Predicciones detalladas</h3>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Clase real</th>
          <th>Predicci√≥n LLM</th>
        </tr>
      </thead>
      <tbody>
        {% for row in results %}
        <tr>
          <td>{{ row[0] }}</td>
          <td>{{ row[1] }}</td>
          <td>{{ row[2] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>
